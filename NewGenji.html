<!DOCTYPE html>
<html>
<style>canvas { border: 2px solid red; background-color: green;} </style>
<body>

<canvas width=1000 height=600 id="myCanvas"></canvas>
<p id="demo"></p>

<script>
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

//BACKGROUND IMAGE
var canvasBackground = new Image();
canvasBackground.src = "background.png";

//DASH SHEET
var dashRightSheet = new Image();
dashRightSheet.src = "dashRight.png";

//TRAINING BOT
var trainingBot = new Image();
trainingBot.src = "TrainingBot.png";

//DASH VARIABLES
var numbRightDashImages = 5;
var currRightDashImage = 1;
var DashWidth = 180, DashHeight = 100;
var numbRightDashRows = 1, numbRightDashCols = 5;
var currRightDashCol = 0;

//SPRITESHEET FOR THROWING ANIMATION
var throwSheet = new Image();
throwSheet.src = "ShurikenSheet.png";
var deflectsheet = new Image();
deflectsheet.src = "DeflectSheet.png";
var thingy = new Image();
thingy.src = "Draw.png";
//RUNNING SHEETS
var runningRightSheet = new Image();
runningRightSheet.src = "RunSheetRight.png";
var runningLeftSheet = new Image();
runningLeftSheet.src = "RunSheetLeft.png";


//SHURIKEN IMAGES
var shuriken = new Image();
shuriken.src = 'shuriken1.jpg';
var shuriken2 = new Image();
shuriken2.src = 'shuriken2.jpg';
var shuriken3 = new Image();
shuriken3.src = 'shuriken3.jpg';

//FROM THROWING ANIMATION
var numbImages = 6;
var currImage = 0;
var ThrowimageWidth = 200, ThrowimageHeight = 204;
var DeflectimageWidth = 165, DeflectimageHeight = 205;
var numbRows = 2, numbCols = 3;
var cycleCount = 0;
var frameNumb = 0;
var currDeflectImage = 0;
var currShurikenImage = 0;

//GENJI VARIABLES
var genjiX = 250;
var genjiY = 365;
currRightRunCol = 0;
currLeftRunCol = 4; 
GenjiImageWidth = 130;
GenjiImageHeight = 183;
currImage=1;

//CLEAR BACKGROUND VARS
var backgroundX = 0;
var RunFrameWidth = 400;
var RunFrameHeight = 600;


//FROM SHURIKEN ANIMATION
var Tire1 = document.getElementById("T1");
var angleA = 0.0, angleB = 0.0, angleC = 0.0;
var xA = genjiX+100, yA = genjiY+60, widthA = 20, heightA = 15;
var xB = genjiX-70, yB = genjiY+60, widthB = 20, heightB = 15, widthA = 20, heightA = 15;
var xC = genjiX-220, yC = genjiY+60, widthC = 20, heightC = 15;
var xBike = 57, yBike = 10, widthBike = 200, heightBike = 130;
var counter = 0;
var counter2 = 0;
var ThrowOn = false;
var DeflectOn = false;
var running = true;

//RUNNING STATES
var RunningPossible = true;
RightRunning=false;
LeftRunning=false;
DownRunning=false;

//STATES
var bottom = 1;
var right = 2;
var top = 3;
var left = 4;
var CurrentState = top;
var stopped =  true;

addEventListener("keydown", handleKey, false);

document.body.onkeyup = function(e){

//D KEY FOR RUNNING RIGHT
    if(e.keyCode == 68 && RightRunning==true){
      RightRunning=false;
      currentlyRunning=false;
      clearInterval(toggleRightRun);
      stopped=true;
      currImage=1;
      currRightRunCol=0;
    }

    if(e.keyCode == 74 && RightRunning==true){
      clearInterval(toggleRightRun);
      startDeflect();
      stopped=true;
    }
    else if (e.keyCode == 74 && ThrowOn==false){
      clearInterval(toggleRightRun);
      startDeflect();
    }
}



function handleTheClick() {
  running = !running;
}
//START FUNCTIONS
function startThrow(){
  if(ThrowOn==false)
    clearInterval(toggleRightRun);
    clearInterval(toggleLeftRun);
    clearInterval(toggleDeflect);
    currImage=1;
    runThrow();
}

function startDeflect(){
  if(DeflectOn==false){
    clearInterval(toggleRightRun);
    clearInterval(toggleLeftRun);
    clearInterval(toggleThrow);
    currImage=1;
    runDeflect();
  }
}

function startRun(){
  if(ThrowOn==false && DeflectOn==false)
    runRun();
}

//ANIMATION FUNCTIONS
function animateThrow() {
  Throw1();
  drawThrow();

  if(cycleCount==2 && currShurikenImage==5){
    ctx.drawImage( throwSheet, 0 , 0, ThrowimageWidth, ThrowimageHeight, genjiX, genjiY, ThrowimageWidth, ThrowimageHeight );
    currShurikenImage = 0;
    cycleCount = 0;
  }
}

function animateDeflect(){
  if(running) {
    //DrawBlade();
    clearActionBackground();
    Deflect();
  }
}

var Dashed = false;

//DASH
function startDash(){
    if(Dashed==false)
      runDash();
}
var toggleRun;
  var runDash = function(){
  toggleRun = setInterval( animateDash, 30 );
}

var JustDashed = false;

function animateDash() {
    backgroundX -=20;
    genjiX+=60;
    clearBackground();
    drawDash();
    Dashed=true;
}

function drawDash() {
  var currRow = 0;
  if(DashOn==true){
   if(currRightDashImage<=5){
    if(currRightDashImage==1){
       ctx.drawImage( dashRightSheet, currRightDashCol*DashWidth , 0, DashWidth, DashHeight, genjiX, genjiY-4, DashWidth+ 20, DashHeight + 80);
    }
    else if(currRightDashImage==2){
      ctx.drawImage( dashRightSheet, currRightDashCol*DashWidth , 0, DashWidth, DashHeight, genjiX+5, genjiY, DashWidth+ 20, DashHeight + 80);
    }
    else if(currRightDashImage==4){
      ctx.drawImage( dashRightSheet, currRightDashCol*DashWidth +5 , 0, DashWidth, DashHeight, genjiX-5, genjiY+4, DashWidth+ 20, DashHeight + 80);
    }
    else if (currRightDashImage==5){
       ctx.drawImage( dashRightSheet, 0 , 1*DashHeight+10, 200, 140, genjiX+2, genjiY - 50, DashWidth + 20, DashHeight + 100);
       RightRunning=true;
    }
    else
    ctx.drawImage( dashRightSheet, currRightDashCol*DashWidth , 0, DashWidth+ 20, 140, genjiX, genjiY, DashWidth, DashHeight + 80);
      currRightDashCol++;
      currRightDashImage++;
    }
  else{
    ctx.drawImage( throwSheet, 0 , 0, 200, 204, genjiX-10, genjiY, 200, 204 );
    clearInterval(toggleRun);
    currRightDashImage=1;
    currRightDashCol=0;
    DashOn=false;
    clearInterval(toggleAnimate);
    animateSpeed = 80;
    animationInterval();
    JustDashed=true;
  }
}
}
var frameSpeed;
//TOGGLES
var toggleThrow;
var runThrow = function(){
    toggleThrow = setInterval( animateThrow, 40 );
    frameSpeed = 40;
}

var toggleDeflect;
var runDeflect = function(){
    toggleDeflect = setInterval( animateDeflect, 90 );
    frameSpeed = 90;
}

//TOGGLING RUN
var toggleRightRun;
  var runRightRun = function(){
  if(ThrowOn==false && DeflectOn==false){
    toggleRightRun = setInterval( drawRightSprite, 100 );
    stopped=false;
    frameSpeed = 100;
  }
}


var toggleBots;
  var runBots = function(){
    toggleBots = setInterval(animateBot, frameSpeed);
}

function animateBot(){
  if(RightRunning==false){
    clearActionBackground();
  }
  drawBot();
}

function drawRightSprite(){
  if(currentlyRunning==true){
  RightRunning=true;
  clearBackground();
  drawRightRun();
}
}

var randNumb;

var currentlyRunning = false;
var drawingBot = false;
var dashAble = true;
//ANIMATE ALL
function animateAll(){
  if(genjiX<=250){
    dashAble=true;
  }
  else{
    dashAble=false;
  }
  randNumb = Math.random() * 10;
  if(BotRunning==true){
    drawingBot=true;
    if(currentlyRunning==false){
      clearActionBackground();
      if(ThrowOn==false && RightRunning==false)
        drawBot();
    }
    if(BotX<-120)
      BotX=1000 + 200*randNumb;
  }
  if(RightRunning==true && BotRunning!=true && ThrowOn!=true && DashOn!=true){
    if(RightRunning==true){
      clearBackground();
      drawRightRun();
      if(drawingBot==true)
        drawBot();
    }
    else if (stopped==true){
      ctx.drawImage( throwSheet, 0 , 0, ThrowimageWidth, ThrowimageHeight, genjiX-10, genjiY, ThrowimageWidth, ThrowimageHeight );
    }
  }
  if(RightRunning==true && BotRunning==true && ThrowOn!=true){
    if(RightRunning==true){
      currentlyRunning=true;
      clearBackground();
      drawRightRun();
      if(drawingBot==true){
        BotSpeed=10;
        drawBot();
      }
      }
  }
    else if(RightRunning==false){
      clearActionBackground();
      if(ThrowOn==false && DashOn==false){
      if(JustDashed==false)
      ctx.drawImage( throwSheet, 0 , 0, ThrowimageWidth, ThrowimageHeight, genjiX, genjiY, ThrowimageWidth, ThrowimageHeight );
      else if(JustDashed==true){
        ctx.drawImage( throwSheet, 0 , 0, ThrowimageWidth, ThrowimageHeight, genjiX-70, genjiY, ThrowimageWidth, ThrowimageHeight );
      }
    }
      if(drawingBot==true){
       BotSpeed=1;
       drawBot();
      }
    }
  if(ThrowOn==true && RightRunning==false){
    animateThrow();
    // if(drawingBot==true){
    //   BotSpeed = .2;
    //   drawBot();
    // }
  }
  else if (ThrowOn==false){
      cycleCount=0;
    }
  if(DashOn==true){
    drawDash();
    backgroundX -=20;
    genjiX+=60;
    Dashed=true;
    if(drawingBot==true){
       BotSpeed=20;
       drawBot();
      }
  }
}

var animateSpeed = 80;
var toggleAnimate;
var animationInterval = function(){
   toggleAnimate = setInterval(animateAll, animateSpeed);
}
animationInterval();
//HANDLEKEYS

var BotRunning = false;
var DashOn = false;

//KEYDOWN!?!?!??!?!?!??!?!?

function handleKey(event) {
  var key = event.key;
  // runBots();
  //JUMP
  if(key == 'w') {
    genjiY-=10;
  }
  //MOVE RIGHT
  else if(key == 'd') {
    JustDashed=false;
    if(ThrowOn!=true)
     RightRunning=true;
    if(DeflectOn==false || ThrowOn==false){
    }
    if(RightRunning==false && DeflectOn==false && stopped==true && ThrowOn==false && LeftRunning==false){
      runRightRun();
    }
    else{
    }
  }
  if(key == 'e'){
    if(dashAble){
    RightRunning=false;
    }
    stopped=false;
    if(dashAble==true){
    clearInterval(toggleAnimate);
    animateSpeed = 30;
    animationInterval();
    DashOn=true;
    Dashed=true;
  }
  }
  if(key == ' '){
      JustDashed=false;
      if(ThrowOn==false && cycleCount<2){
      clearInterval(toggleAnimate);
      animateSpeed = 40;
      animationInterval();
      ThrowOn=true; 
      RightRunning=false;
    }
    }

  if(key == 'b'){
    BotRunning=true;
  }
  if(key!='d' && key !=' ' && key!='e' && key !='j') 
    stopped=true;
}

function drawRightRun() {
  var currRow = 0;
  stopped = false;
  if(Dashed==true && genjiX>=250){
    genjiX-=10;
    backgroundX-=10;
  }
  else if(genjiX<=250){
    Dashed=false;
  }

   if(currImage<=5&&currRightRunCol<5){
    if(currImage==1){
       ctx.drawImage( runningRightSheet, currRightRunCol*GenjiImageWidth , 0, GenjiImageWidth, GenjiImageHeight, genjiX, genjiY+6, GenjiImageWidth, GenjiImageHeight );
    }
    else if(currImage==2){
      ctx.drawImage( runningRightSheet, currRightRunCol*GenjiImageWidth , 0, GenjiImageWidth, GenjiImageHeight, genjiX+5, genjiY+10, GenjiImageWidth, GenjiImageHeight );
    }
    else if(currImage==4){
      ctx.drawImage( runningRightSheet, currRightRunCol*GenjiImageWidth , 0, GenjiImageWidth, GenjiImageHeight, genjiX-5, genjiY+14, GenjiImageWidth, GenjiImageHeight );
    }
    else if (currImage==5){
       ctx.drawImage( runningRightSheet, currRightRunCol*GenjiImageWidth , 0, GenjiImageWidth, GenjiImageHeight, genjiX+2, genjiY+6, GenjiImageWidth, GenjiImageHeight );
    }
    else
    ctx.drawImage( runningRightSheet, currRightRunCol*GenjiImageWidth , 0, GenjiImageWidth, GenjiImageHeight, genjiX, genjiY+10, GenjiImageWidth, GenjiImageHeight );

      currRightRunCol++;
      currImage++;
    }
  else{
    currImage=1;
    currRightRunCol=0;
    ctx.drawImage( runningRightSheet, currRightRunCol*GenjiImageWidth , 0, GenjiImageWidth, GenjiImageHeight, genjiX-5, genjiY, GenjiImageWidth, GenjiImageHeight );
    currRightRunCol++;
    currImage++;
  }
}


var xRealA = genjiX+100;

function Throw1() {

  if(AHitTarget==true){
    widthA = 0;
    heightA = 0;
  }
  ctx.save();
  ctx.translate( xA + widthA/2, yA + heightA/2 );
  xA += 75;
  angleA += .8;
  ctx.rotate( angleA );
  ctx.drawImage(shuriken, -widthA/2, -heightA/2, widthA, heightA);
  ctx.restore();

  
if(xB<xRealA + widthA/2 || BHitTarget==true){
    widthB = 0;
    heightB = 0;
  }
  else {
    widthB = 20;
    heightB = 15;
  }


  ctx.save();
  ctx.translate( xB + widthB/2, yB + heightB/2 );
  xB += 75;
  angleB += .8;
  ctx.rotate( angleB );
  ctx.drawImage(shuriken2,-widthB/2, -heightB/2 , widthB, heightB);
  ctx.restore();


if(xC< xRealA + widthA/2 || CHitTarget==true){
  widthC = 0;
  heightC = 0;
  }
 else{
  widthC = 20;
  heightC = 15;
}



  ctx.save();
  ctx.translate(xC + widthC/2, yC + heightC/2 );
  xC += 75;
  angleC += .8;
  ctx.rotate( angleC );
  ctx.drawImage(shuriken2,-widthC/2, -heightC/2, widthC, heightC);
  ctx.restore();



if(xC>=800+genjiX){
  ThrowOn=false;
  clearInterval(toggleAnimate);
  animateSpeed = 80;
  animationInterval();
}

if(xC<800+genjiX){
  ThrowOn=true;
}

else{
  AHitTarget = false;
  BHitTarget = false;
  CHitTarget = false;
  widthA = 20;
  widthB = 20;
  widthC = 20;
  heightA = 15;
  heightB = 15;
  heightC = 15;
  xA = genjiX+100;
  xB = genjiX-70;
  xC = genjiX-220;
  xRealA = genjiX+100;
}

if(xA>=BotX && xA<=BotX+trainingBot.width){
  AHitTarget=true;
}
if(xB>=BotX && xB<=BotX+trainingBot.width){
  BHitTarget=true;
}
if(xC>=BotX && xC<=BotX+trainingBot.width){
  CHitTarget=true;
}
} 

var AHitTarget = false;
var BHitTarget = false;
var CHitTarget = false;

function clearActionBackground(){
  ctx.drawImage(canvasBackground, 0-backgroundX, 0, RunFrameWidth, RunFrameHeight, 0, 0, 1000, 1300); }

function clearBackground() {
  backgroundX-=6;
  if(backgroundX < -399) 
    backgroundX = 0;
  ctx.drawImage(canvasBackground, 0-backgroundX, 0, RunFrameWidth, RunFrameHeight, 0, 0, 1000, 1300); 
}

function drawThrow() {
  var currRow = Math.floor(currShurikenImage / numbCols);
  var currCol = currShurikenImage % numbCols;

  if(currShurikenImage==5 && cycleCount<2){
    currShurikenImage=1;
    currRow=0;
    currCol=0;
    cycleCount++;
  }
  if(cycleCount<2){
  ctx.drawImage( throwSheet, currCol*ThrowimageWidth , currRow*ThrowimageHeight, ThrowimageWidth, ThrowimageHeight, genjiX, genjiY, ThrowimageWidth, ThrowimageHeight );
  currShurikenImage++;
  currShurikenImage %= numbImages;
}
  else{
     ctx.drawImage( throwSheet, 0*ThrowimageWidth , 0*ThrowimageHeight, ThrowimageWidth, ThrowimageHeight, genjiX, genjiY, ThrowimageWidth, ThrowimageHeight );
  }
}

////////DEFLECT STUFF
function DrawBlade(){
    ctx.drawImage( thingy, 0, 0, 165, 205, genjiX, genjiY, DeflectimageWidth, DeflectimageHeight );
}

function SheathBlade (){ 
  ctx.drawImage( thingy, 170, 0, 165, 205, genjiX, genjiY, DeflectimageWidth, DeflectimageHeight );
  frameNumb=0;
}

function Deflect() {
  DeflectOn=true;
  if (currDeflectImage==-1){
    DrawBlade();
    currDeflectImage++;
  }
  else {
    if(frameNumb<12){
      var currRow = Math.floor(currDeflectImage / numbCols);
      var currCol = currDeflectImage % numbCols;
      if(frameNumb==1 || frameNumb==7){
      ctx.drawImage( deflectsheet, currCol*DeflectimageWidth, currRow*DeflectimageHeight, DeflectimageWidth,DeflectimageHeight, genjiX, genjiY-10, DeflectimageWidth, DeflectimageHeight );
      }
      else{
      ctx.drawImage( deflectsheet, currCol*DeflectimageWidth, currRow*DeflectimageHeight, DeflectimageWidth,DeflectimageHeight, genjiX, genjiY, DeflectimageWidth, DeflectimageHeight );
      }
      currDeflectImage++;
      currDeflectImage %= numbImages;
      frameNumb++;
    }

    else {
      SheathBlade();
      clearInterval(toggleDeflect);
      DeflectOn=false;
      currDeflectImage=-1;
    }
}
}


var BotX = 1000;
var BotY = genjiY;
var BotSpeed = 1;
function drawBot(){
  BotX=BotX-BotSpeed;
  ctx.drawImage( trainingBot, 0, 0, trainingBot.width, trainingBot.height, BotX, genjiY-10, trainingBot.width-75, trainingBot.height-75);
}

</script>

</body>
</html> 